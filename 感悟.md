
# ESP8266 同时用 GPS 软件串口和 I2C 屏幕，为什么 GPS 串口会乱码？如何解决？

## 前言

很多 DIYer 用 ESP8266 做 GPS 定位项目，喜欢把 GPS 模块和 OLED（I2C接口）屏幕同时挂在板子上。**最常见的用法是 GPS 走 SoftwareSerial（因为主串口被USB调试占用），屏幕用硬件 I2C（Wire）。**

不少人发现，只要插上屏幕，GPS 串口数据就立刻开始乱码、丢字节、TinyGPS++解码失败；但拔掉屏幕，GPS 又完全正常。这到底是为什么？引脚都不冲突，为啥还会这样？

这篇文章给你一个专业而清晰的答案。

---

## 现象复现

* 只接 GPS，用 SoftwareSerial 读数据，NMEA 语句完整，定位正常。
* 同时插上 I2C 屏幕（比如 OLED），GPS 串口输出马上就开始丢字、乱码、解码失败。

---

## 根本原因分析：软件外设“时间片”抢占冲突

### 1. ESP8266 软件串口（SoftwareSerial）和硬件 I2C 都靠主 CPU 轮询

* ESP8266 只有一个硬件 UART（主串口），通常被 USB 转串口芯片占用做调试和下载，**没法接GPS**。
* 只能用 SoftwareSerial 软串口+Wire库（I2C）。
* 这两套库都是**纯软件模拟**，本质上靠主CPU不断循环“扫引脚”。
* 当你的代码里既要收 GPS 数据、又要控制 I2C 屏幕刷图时，**CPU 必须在多组GPIO之间切换处理**。

### 2. 并不是“引脚冲突”，而是“资源竞争”

* 很多人以为只要引脚不同，互不影响。**实际上 ESP8266 的软串口和I2C在底层会抢占CPU资源**。
* 如果你的主循环很频繁地操作 OLED 屏（比如每50ms刷一次屏），就会**导致 SoftwareSerial 读取 GPS 数据时“漏读”、丢字节、导致 TinyGPS++ 解码失败、NMEA语句格式乱套**。

### 3. 软件串口的局限性

* ESP8266 的 SoftwareSerial 只能“救急”用，不适合高频、长时间、和其它高IO密集型外设并用。
* 串口数据丢失、乱码是“设计局限”导致的，不是你代码有错。

---

## 解决方案

### 1. **降低屏幕刷新频率，分时调度**

不要频繁刷新屏幕，尽量让 SoftwareSerial 有更多时间片读取数据。例如：

```cpp
static unsigned long lastOledUpdate = 0;
if (millis() - lastOledUpdate > 1000) { // 只每秒刷新一次
    updateOled();
    lastOledUpdate = millis();
}
```

这样做会大大减少数据丢失概率。

### 2. **只在屏幕内容有变化时才刷新**

比如GPS定位数据变化再刷屏，否则保持不动。

### 3. **软件架构优化，主循环减少阻塞操作**

主循环只做非阻塞判断，避免delay、避免长时间占用I2C总线或其它IO操作。

### 4. **选择合适的引脚**

虽然不是根本问题，但ESP8266某些引脚用于软件串口比其它更可靠，建议选用 D5、D6、D7（GPIO14/12/13）等做SoftwareSerial。

### 5. **极致方案：升级为ESP32**

如果你的应用必须高频读GPS+高频刷屏，建议换用ESP32，支持多个硬件串口和I2C，完全不会有这个问题。

---

## 总结

**ESP8266上同时用软件串口读GPS和I2C屏幕，不是引脚冲突而是CPU时间抢占冲突！**
你只要大幅降低屏幕刷新频率，让CPU有足够时间处理软串口收数据，绝大多数项目就能正常运行。

遇到这类问题，无需纠结代码细节，**认清芯片本身的资源限制，合理安排时间片，软硬兼施才能玩得好。**
